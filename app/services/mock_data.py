from __future__ import annotations
from typing import List, Tuple

import numpy as np
import pandas as pd
from fastapi import HTTPException

MOCK_GENES: List[str] = [
   "ENSG00000250577","ENSG00000171657","ENSG00000249877","ENSG00000164604",
    "ENSG00000181656","ENSG00000270702","ENSG00000170412","ENSG00000132522",
    "ENSG00000236919","ENSG00000248015","ENSG00000278110","ENSG00000167701",
    "ENSG00000253180","ENSG00000233276","ENSG00000197582","ENSG00000228225",
    "ENSG00000260051","ENSG00000282827","ENSG00000237586","ENSG00000215326",
    "ENSG00000176153","ENSG00000225905","ENSG00000211445","ENSG00000271824",
    "ENSG00000224586","ENSG00000260651","ENSG00000231418","ENSG00000183733",
    "ENSG00000267598","ENSG00000274727","ENSG00000198704","ENSG00000116157",
    "ENSG00000243164","ENSG00000154016","ENSG00000268870","ENSG00000254631",
    "ENSG00000257943","ENSG00000100351","ENSG00000141738","ENSG00000106070",
    "ENSG00000115290","ENSG00000280118","ENSG00000279674","ENSG00000277879",
    "ENSG00000137106","ENSG00000155511","ENSG00000120251","ENSG00000125675",
    "ENSG00000152578","ENSG00000182771","ENSG00000152208","ENSG00000275572",
    "ENSG00000207408","ENSG00000171189","ENSG00000164418","ENSG00000257258",
    "ENSG00000258827","ENSG00000256843","ENSG00000257595","ENSG00000163873",
    "ENSG00000267214","ENSG00000149403","ENSG00000250625","ENSG00000105737",
    "ENSG00000176884","ENSG00000176826","ENSG00000183454","ENSG00000273079",
    "ENSG00000161509","ENSG00000254712","ENSG00000105464","ENSG00000125388",
    "ENSG00000202310","ENSG00000198873","ENSG00000269575","ENSG00000277987",
    "ENSG00000237178","ENSG00000198055","ENSG00000215571","ENSG00000237493",
    "ENSG00000250604","ENSG00000152822","ENSG00000276136","ENSG00000274321",
    "ENSG00000164082","ENSG00000198822","ENSG00000124493","ENSG00000255082",
    "ENSG00000236202","ENSG00000214955","ENSG00000267927","ENSG00000270426",
    "ENSG00000237665","ENSG00000226258","ENSG00000225611","ENSG00000255396",
    "ENSG00000164946","ENSG00000179603","ENSG00000134443","ENSG00000233211",

    "ENSG00000225814","ENSG00000230682","ENSG00000133937","ENSG00000063515",
    "ENSG00000105723","ENSG00000082701","ENSG00000204148","ENSG00000277161",
    "ENSG00000152779","ENSG00000263716","ENSG00000271419","ENSG00000189369",
    "ENSG00000259727","ENSG00000104687","ENSG00000100983","ENSG00000243955",
    "ENSG00000244067","ENSG00000170899","ENSG00000223622","ENSG00000254224",
    "ENSG00000255133","ENSG00000257852","ENSG00000236075","ENSG00000237674",
    "ENSG00000264379","ENSG00000230845","ENSG00000283324","ENSG00000217228",
    "ENSG00000138780","ENSG00000134184","ENSG00000278050","ENSG00000272657",
    "ENSG00000229278","ENSG00000233981","ENSG00000263547","ENSG00000213366",
    "ENSG00000168765","ENSG00000258552","ENSG00000236062","ENSG00000084207",
    "ENSG00000283467","ENSG00000099984","ENSG00000133433","ENSG00000140307",
    "ENSG00000248928","ENSG00000207209","ENSG00000248911","ENSG00000153767",
    "ENSG00000276823","ENSG00000199282","ENSG00000283291","ENSG00000197265",
    "ENSG00000233427","ENSG00000280427","ENSG00000125651","ENSG00000252420",
    "ENSG00000201388","ENSG00000267640","ENSG00000188342","ENSG00000230994",
    "ENSG00000251254","ENSG00000283502","ENSG00000110768","ENSG00000207516",
    "ENSG00000276100","ENSG00000145736","ENSG00000254027","ENSG00000111358",
    "ENSG00000201701","ENSG00000213780","ENSG00000263001","ENSG00000277053",
    "ENSG00000233369","ENSG00000273961","ENSG00000266736","ENSG00000227038",
    "ENSG00000224881","ENSG00000139445","ENSG00000268392","ENSG00000276706",
    "ENSG00000276318","ENSG00000251451","ENSG00000200120","ENSG00000255199",
    "ENSG00000226002","ENSG00000259095","ENSG00000230295","ENSG00000006704",
    "ENSG00000212595","ENSG00000196275","ENSG00000276039","ENSG00000251830",
    "ENSG00000122034","ENSG00000115207","ENSG00000119041","ENSG00000100226",
    "ENSG00000260038","ENSG00000202198","ENSG00000273927","ENSG00000199470",

     "ENSG00000279183", "ENSG00000172432", "ENSG00000112599", "ENSG00000138472", "ENSG00000277577",
    "ENSG00000227148", "ENSG00000238390", "ENSG00000206651", "ENSG00000197273", "ENSG00000252204",
    "ENSG00000137942", "ENSG00000206797", "ENSG00000256725", "ENSG00000238745", "ENSG00000152402",
    "ENSG00000238761", "ENSG00000280127", "ENSG00000278938", "ENSG00000164116", "ENSG00000123201",
    "ENSG00000206911", "ENSG00000061918", "ENSG00000132518", "ENSG00000204529", "ENSG00000101890",
    "ENSG00000143774", "ENSG00000234770", "ENSG00000274008", "ENSG00000279654", "ENSG00000281269",
    "ENSG00000260351", "ENSG00000272237", "ENSG00000277269", "ENSG00000212279", "ENSG00000170270",
    "ENSG00000169919", "ENSG00000236296", "ENSG00000224458", "ENSG00000227762", "ENSG00000212553",
    "ENSG00000215630", "ENSG00000224723", "ENSG00000252824", "ENSG00000279336", "ENSG00000222001",
    "ENSG00000133136", "ENSG00000228315", "ENSG00000230177", "ENSG00000271499", "ENSG00000273345",
    "ENSG00000278687", "ENSG00000259083", "ENSG00000199291", "ENSG00000223410", "ENSG00000267559",
    "ENSG00000234932", "ENSG00000262160", "ENSG00000254686", "ENSG00000265188", "ENSG00000277704",
    "ENSG00000056998", "ENSG00000235483", "ENSG00000206159", "ENSG00000136732", "ENSG00000238097",
    "ENSG00000197465", "ENSG00000254973", "ENSG00000145649", "ENSG00000100453", "ENSG00000100450",
    "ENSG00000276951", "ENSG00000220643", "ENSG00000249593", "ENSG00000253832", "ENSG00000113088",
    "ENSG00000115226", "ENSG00000189060", "ENSG00000184897", "ENSG00000281676", "ENSG00000261451",
    "ENSG00000201003", "ENSG00000278482", "ENSG00000201668", "ENSG00000213440", "ENSG00000236386",
    "ENSG00000218502", "ENSG00000119686", "ENSG00000255329", "ENSG00000234612", "ENSG00000233733",
    "ENSG00000163041", "ENSG00000201549", "ENSG00000132475", "ENSG00000254662", "ENSG00000253907",
    "ENSG00000222604", "ENSG00000265541", "ENSG00000049239", "ENSG00000272384", "ENSG00000130600",
    "ENSG00000224548", "ENSG00000259577", "ENSG00000202407", "ENSG00000214019",

    "ENSG00000162882", "ENSG00000148702", "ENSG00000188921", "ENSG00000252695",
    "ENSG00000280264", "ENSG00000226541", "ENSG00000202309", "ENSG00000268678",
    "ENSG00000174567", "ENSG00000084754", "ENSG00000251596", "ENSG00000207100",
    "ENSG00000138029", "ENSG00000256346", "ENSG00000063854", "ENSG00000084110",
    "ENSG00000113196", "ENSG00000275239", "ENSG00000279925", "ENSG00000200436",
    "ENSG00000164107", "ENSG00000101323", "ENSG00000252236", "ENSG00000239040",
    "ENSG00000274617", "ENSG00000200888", "ENSG00000116882", "ENSG00000253384",
    "ENSG00000280316", "ENSG00000230921", "ENSG00000173805", "ENSG00000170445",
    "ENSG00000112855", "ENSG00000234308", "ENSG00000249692", "ENSG00000273855",
    "ENSG00000273295", "ENSG00000250994", "ENSG00000244234", "ENSG00000224194",
    "ENSG00000231977", "ENSG00000105509", "ENSG00000170961", "ENSG00000269275",
    "ENSG00000251296", "ENSG00000227154", "ENSG00000103044", "ENSG00000224656",
    "ENSG00000276800", "ENSG00000128708", "ENSG00000234111", "ENSG00000227344",
    "ENSG00000236121", "ENSG00000257300", "ENSG00000206172", "ENSG00000188536",
    "ENSG00000279286", "ENSG00000275871", "ENSG00000247763", "ENSG00000258904",
    "ENSG00000244734", "ENSG00000203531", "ENSG00000274893", "ENSG00000229988",
    "ENSG00000273591", "ENSG00000213934", "ENSG00000272025", "ENSG00000228935",
    "ENSG00000196565", "ENSG00000270367", "ENSG00000206177", "ENSG00000269901",
    "ENSG00000278834", "ENSG00000244184", "ENSG00000223975", "ENSG00000086506",
    "ENSG00000279490", "ENSG00000112339", "ENSG00000233263", "ENSG00000196917",
    "ENSG00000235802", "ENSG00000233055", "ENSG00000258772", "ENSG00000176998",
    "ENSG00000264116", "ENSG00000283398", "ENSG00000204625", "ENSG00000228022",
    "ENSG00000234986", "ENSG00000233529", "ENSG00000228962", "ENSG00000204671",
    "ENSG00000101336", "ENSG00000233765", "ENSG00000250207", "ENSG00000278239",

    "ENSG00000180353", "ENSG00000265205", "ENSG00000164588", "ENSG00000235499",
    "ENSG00000099822", "ENSG00000248616", "ENSG00000196591", "ENSG00000249706",
    "ENSG00000259556", "ENSG00000244502", "ENSG00000229037", "ENSG00000068097",
    "ENSG00000207161", "ENSG00000279287", "ENSG00000240861", "ENSG00000278311",
    "ENSG00000278040", "ENSG00000201277", "ENSG00000213068", "ENSG00000253423",
    "ENSG00000173064", "ENSG00000207217", "ENSG00000254690", "ENSG00000226433",
    "ENSG00000252170", "ENSG00000281344", "ENSG00000181333", "ENSG00000230970",
    "ENSG00000248929", "ENSG00000221332", "ENSG00000278413", "ENSG00000207091",
    "ENSG00000255254", "ENSG00000237303", "ENSG00000258104", "ENSG00000254455",
    "ENSG00000227644", "ENSG00000236012", "ENSG00000170011", "ENSG00000276225",
    "ENSG00000263396", "ENSG00000251019", "ENSG00000248785", "ENSG00000234921",
    "ENSG00000237005", "ENSG00000199370", "ENSG00000219608", "ENSG00000274841",
    "ENSG00000279750", "ENSG00000279691", "ENSG00000258886", "ENSG00000238297",
    "ENSG00000280301", "ENSG00000254833", "ENSG00000261173", "ENSG00000226989",
    "ENSG00000253952", "ENSG00000267723", "ENSG00000100296", "ENSG00000224626",
    "ENSG00000214254", "ENSG00000271230", "ENSG00000254158", "ENSG00000241180",
    "ENSG00000199516", "ENSG00000231531", "ENSG00000238371", "ENSG00000127946",
    "ENSG00000124610", "ENSG00000264596", "ENSG00000234761", "ENSG00000251014",
    "ENSG00000268225", "ENSG00000249948", "ENSG00000184357", "ENSG00000187837",
    "ENSG00000276918", "ENSG00000235105", "ENSG00000235820", "ENSG00000124575",
    "ENSG00000260671", "ENSG00000258666", "ENSG00000266549", "ENSG00000168298",
    "ENSG00000216331", "ENSG00000187475", "ENSG00000278463", "ENSG00000274408",
    "ENSG00000283072", "ENSG00000200241", "ENSG00000272438", "ENSG00000180573",
    "ENSG00000239486", "ENSG00000234484", "ENSG00000223729", "ENSG00000280410",
    "ENSG00000279929", "ENSG00000123815", "ENSG00000186188", "ENSG00000224267",

    "ENSG00000277075", "ENSG00000201368", "ENSG00000196787", "ENSG00000227189",
    "ENSG00000260177", "ENSG00000251226", "ENSG00000279459", "ENSG00000201788",
    "ENSG00000283262", "ENSG00000261669", "ENSG00000238210", "ENSG00000196747",
    "ENSG00000203781", "ENSG00000222000", "ENSG00000261519", "ENSG00000267794",
    "ENSG00000255983", "ENSG00000280440", "ENSG00000265845", "ENSG00000270882",
    "ENSG00000276368", "ENSG00000275221", "ENSG00000276903", "ENSG00000278677",
    "ENSG00000223383", "ENSG00000276410", "ENSG00000206721", "ENSG00000180596",
    "ENSG00000232896", "ENSG00000259732", "ENSG00000228108", "ENSG00000232140",
    "ENSG00000254914", "ENSG00000233268", "ENSG00000236907", "ENSG00000274290",
    "ENSG00000277224", "ENSG00000206961", "ENSG00000252682", "ENSG00000223080",
    "ENSG00000251864", "ENSG00000241549", "ENSG00000260015", "ENSG00000201217",
    "ENSG00000276105", "ENSG00000277035", "ENSG00000212626", "ENSG00000275713",
    "ENSG00000124635", "ENSG00000185130", "ENSG00000229369", "ENSG00000239182",
    "ENSG00000273703", "ENSG00000233822", "ENSG00000274641", "ENSG00000274562",
    "ENSG00000271056", "ENSG00000217646", "ENSG00000224870", "ENSG00000199870",
    "ENSG00000255200", "ENSG00000276632", "ENSG00000226908", "ENSG00000275930",
    "ENSG00000280225", "ENSG00000201432", "ENSG00000275714", "ENSG00000200448",
    "ENSG00000279413", "ENSG00000228721", "ENSG00000172757", "ENSG00000274267",
    "ENSG00000278272", "ENSG00000197409", "ENSG00000201733", "ENSG00000207147",
    "ENSG00000200191", "ENSG00000277488", "ENSG00000106415", "ENSG00000146047",
    "ENSG00000277775", "ENSG00000273983", "ENSG00000233754", "ENSG00000256783",
    "ENSG00000275379", "ENSG00000200742", "ENSG00000152670", "ENSG00000197153",
    "ENSG00000283138", "ENSG00000197061", "ENSG00000277157", "ENSG00000201398",
    "ENSG00000254092", "ENSG00000272360", "ENSG00000228835", "ENSG00000201885",
    "ENSG00000169635", "ENSG00000276966", "ENSG00000207407", "ENSG00000274618",
    
    "ENSG00000275663", "ENSG00000158406", "ENSG00000276180", "ENSG00000197238", "ENSG00000275126",
    "ENSG00000203812", "ENSG00000260255", "ENSG00000271257", "ENSG00000241354", "ENSG00000279502",
    "ENSG00000277510", "ENSG00000270936", "ENSG00000139436", "ENSG00000184678", "ENSG00000213244",
    "ENSG00000245498", "ENSG00000269845", "ENSG00000283491", "ENSG00000252319", "ENSG00000271616",
    "ENSG00000274415", "ENSG00000184492", "ENSG00000230699", "ENSG00000168148", "ENSG00000260329",
    "ENSG00000258789", "ENSG00000127124", "ENSG00000159399", "ENSG00000228612", "ENSG00000217041",
    "ENSG00000160883", "ENSG00000219150", "ENSG00000244245", "ENSG00000277469", "ENSG00000227083",
    "ENSG00000241818", "ENSG00000270289", "ENSG00000206503", "ENSG00000196301", "ENSG00000124688",
    "ENSG00000277535", "ENSG00000241434", "ENSG00000206886", "ENSG00000204592", "ENSG00000277830",
    "ENSG00000204642", "ENSG00000224372", "ENSG00000264475", "ENSG00000228078", "ENSG00000235301",
    "ENSG00000237646", "ENSG00000239718", "ENSG00000235313", "ENSG00000248641", "ENSG00000124097",
    "ENSG00000224159", "ENSG00000236869", "ENSG00000275490", "ENSG00000258301", "ENSG00000272043",
    "ENSG00000236045", "ENSG00000250579", "ENSG00000276089", "ENSG00000213707", "ENSG00000207229",
    "ENSG00000274892", "ENSG00000224884", "ENSG00000230547", "ENSG00000279144", "ENSG00000220557",
    "ENSG00000233671", "ENSG00000279296", "ENSG00000230886", "ENSG00000225984", "ENSG00000230611",
    "ENSG00000249745", "ENSG00000243832", "ENSG00000250862", "ENSG00000225643", "ENSG00000244089",
    "ENSG00000252655", "ENSG00000277968", "ENSG00000264452", "ENSG00000233266", "ENSG00000278276",
    "ENSG00000264040", "ENSG00000226837", "ENSG00000232999", "ENSG00000212302", "ENSG00000259488",
    "ENSG00000278859", "ENSG00000230737", "ENSG00000251566", "ENSG00000283545", "ENSG00000243873",
    "ENSG00000206853", "ENSG00000280575", "ENSG00000174807", "ENSG00000203489", "ENSG00000253516",
    
    "ENSG00000131152", "ENSG00000254735", "ENSG00000277702", "ENSG00000100429", "ENSG00000249338",
    "ENSG00000234379", "ENSG00000237642", "ENSG00000268560", "ENSG00000213070", "ENSG00000215399",
    "ENSG00000227096", "ENSG00000229992", "ENSG00000223656", "ENSG00000237409", "ENSG00000213301",
    "ENSG00000279809", "ENSG00000255129", "ENSG00000237603", "ENSG00000253372", "ENSG00000214288",
    "ENSG00000231845", "ENSG00000250897", "ENSG00000275460", "ENSG00000122694", "ENSG00000201285",
    "ENSG00000220875", "ENSG00000248430", "ENSG00000199444", "ENSG00000201987", "ENSG00000255271",
    "ENSG00000249400", "ENSG00000267143", "ENSG00000200432", "ENSG00000229046", "ENSG00000231830",
    "ENSG00000252677", "ENSG00000276074", "ENSG00000277352", "ENSG00000273599", "ENSG00000267828",
    "ENSG00000246640", "ENSG00000224040", "ENSG00000230942", "ENSG00000206895", "ENSG00000251866",
    "ENSG00000201311", "ENSG00000274197", "ENSG00000224070", "ENSG00000239614", "ENSG00000207271",
    "ENSG00000251072", "ENSG00000183185", "ENSG00000241120", "ENSG00000236497", "ENSG00000278708",
    "ENSG00000273267", "ENSG00000200305", "ENSG00000134317", "ENSG00000202514", "ENSG00000248377",
    "ENSG00000244101", "ENSG00000207108", "ENSG00000227673", "ENSG00000199895", "ENSG00000235351",
    "ENSG00000249619", "ENSG00000270937", "ENSG00000274904", "ENSG00000248544", "ENSG00000254480",
    "ENSG00000259779", "ENSG00000249439", "ENSG00000250197", "ENSG00000206637", "ENSG00000274133",
    "ENSG00000113249", "ENSG00000276919", "ENSG00000249503", "ENSG00000223188", "ENSG00000230203",
    "ENSG00000281741", "ENSG00000274660", "ENSG00000250787", "ENSG00000234927", "ENSG00000199224",
    "ENSG00000255395", "ENSG00000224519", "ENSG00000239539", "ENSG00000228974", "ENSG00000276770",
    "ENSG00000224195", "ENSG00000237940", "ENSG00000267169", "ENSG00000238012", "ENSG00000236505",
    "ENSG00000200635", "ENSG00000113384", "ENSG00000201025", "ENSG00000275213", "ENSG00000270015",
    
    "ENSG00000226977", "ENSG00000259557", "ENSG00000257012", "ENSG00000279246", "ENSG00000254114",
    "ENSG00000252699", "ENSG00000279537", "ENSG00000277592", "ENSG00000253067", "ENSG00000199442",
    "ENSG00000235028", "ENSG00000237589", "ENSG00000230326", "ENSG00000224755", "ENSG00000206850",
    "ENSG00000172186", "ENSG00000235734", "ENSG00000179240", "ENSG00000231376", "ENSG00000279510",
    "ENSG00000238249", "ENSG00000277721", "ENSG00000260152", "ENSG00000132702", "ENSG00000228734",
    "ENSG00000223452", "ENSG00000229367", "ENSG00000232963", "ENSG00000281137", "ENSG00000228034",
    "ENSG00000206646", "ENSG00000227259", "ENSG00000267482", "ENSG00000224029", "ENSG00000236124",
    "ENSG00000251942", "ENSG00000206846", "ENSG00000229072", "ENSG00000277653", "ENSG00000228398",
    "ENSG00000241203", "ENSG00000264497", "ENSG00000247796", "ENSG00000232916", "ENSG00000236086",
    "ENSG00000274127", "ENSG00000280447", "ENSG00000213721", "ENSG00000214195", "ENSG00000254704",
    "ENSG00000261680", "ENSG00000214281", "ENSG00000260602", "ENSG00000252993", "ENSG00000259246",
    "ENSG00000238311", "ENSG00000183586", "ENSG00000101076", "ENSG00000164749", "ENSG00000150540",
    "ENSG00000229251", "ENSG00000233081", "ENSG00000236985", "ENSG00000227094", "ENSG00000202254",
    "ENSG00000231956", "ENSG00000214223", "ENSG00000279879", "ENSG00000264315", "ENSG00000213568",
    "ENSG00000227638", "ENSG00000214761", "ENSG00000212306", "ENSG00000260507", "ENSG00000199459",
    "ENSG00000181867", "ENSG00000262333", "ENSG00000254706", "ENSG00000276396", "ENSG00000261695",
    "ENSG00000243188", "ENSG00000267615", "ENSG00000200174", "ENSG00000214204", "ENSG00000249271",
    "ENSG00000130720", "ENSG00000259411", "ENSG00000228020", "ENSG00000269119", "ENSG00000229534",
    "ENSG00000227453", "ENSG00000260201", "ENSG00000214783", "ENSG00000227994", "ENSG00000256940",
    "ENSG00000205745", "ENSG00000234181", "ENSG00000201074", "ENSG00000200208", "ENSG00000278951",
    
    "ENSG00000212335", "ENSG00000222095", "ENSG00000265961", "ENSG00000277413", "ENSG00000252888",
    "ENSG00000279084", "ENSG00000213559", "ENSG00000248444", "ENSG00000229221", "ENSG00000279515",
    "ENSG00000230946", "ENSG00000226676", "ENSG00000256673", "ENSG00000257332", "ENSG00000236946",
    "ENSG00000259686", "ENSG00000254713", "ENSG00000236569", "ENSG00000213455", "ENSG00000231663",
    "ENSG00000249697", "ENSG00000258474", "ENSG00000259550", "ENSG00000255141", "ENSG00000214653",
    "ENSG00000283417", "ENSG00000224505", "ENSG00000229774", "ENSG00000233975", "ENSG00000216915",
    "ENSG00000013583", "ENSG00000226068", "ENSG00000236565", "ENSG00000253119", "ENSG00000239699",
    "ENSG00000251256", "ENSG00000250826", "ENSG00000230813", "ENSG00000224494", "ENSG00000270234",
    "ENSG00000256969", "ENSG00000225636", "ENSG00000111536", "ENSG00000266893", "ENSG00000274866",
    "ENSG00000279036", "ENSG00000244640", "ENSG00000123130", "ENSG00000213328", "ENSG00000130956",
    "ENSG00000281295", "ENSG00000201279", "ENSG00000230345", "ENSG00000267233", "ENSG00000275774",
    "ENSG00000204253", "ENSG00000259419", "ENSG00000259067", "ENSG00000280178", "ENSG00000201229",
    "ENSG00000274272", "ENSG00000250238", "ENSG00000263179", "ENSG00000238594", "ENSG00000253687",
    "ENSG00000252045", "ENSG00000213305", "ENSG00000138668", "ENSG00000152795", "ENSG00000226307",
    "ENSG00000234890", "ENSG00000202269", "ENSG00000258116", "ENSG00000236185", "ENSG00000232794",
    "ENSG00000260693", "ENSG00000236770", "ENSG00000217811", "ENSG00000227538", "ENSG00000220305",
    "ENSG00000207286", "ENSG00000273549", "ENSG00000252671", "ENSG00000222852", "ENSG00000213924",
    "ENSG00000248854", "ENSG00000096746", "ENSG00000230247", "ENSG00000228081", "ENSG00000165119",
    "ENSG00000104824", "ENSG00000233503", "ENSG00000251419", "ENSG00000228629", "ENSG00000262539",
    "ENSG00000249012", "ENSG00000274312", "ENSG00000267513", "ENSG00000281010", "ENSG00000207395"
]


def _gamma_poisson_counts(mu: float, dispersion: float, size: int, rng: np.random.Generator) -> np.ndarray:
    """Simulate RNA-seq counts via Gamma-Poisson (Negative Binomial)."""
    alpha = max(dispersion, 1e-8)
    shape = 1.0 / alpha
    scale = alpha * mu
    lam = rng.gamma(shape=shape, scale=scale, size=size)
    return rng.poisson(lam)


def generate_mock_dataset(
    requested_genes: List[str],
    condition_a: str,
    condition_b: str,
    n_per_group: int = 80,
    seed: int = 42,
) -> Tuple[pd.DataFrame, pd.DataFrame]:
    """Generate synthetic counts (genes x samples) and phenotype table."""
    geneIds = [g for g in requested_genes if g in MOCK_GENES]
    if not geneIds:
        raise HTTPException(status_code=400, detail="None of the requested genes are in the mock gene set.")

    rng = np.random.default_rng(seed)
    samples_a = [f"A{i:02d}" for i in range(1, n_per_group + 1)]
    samples_b = [f"B{i:02d}" for i in range(1, n_per_group + 1)]
    all_samples = samples_a + samples_b

    pheno = pd.DataFrame(
        {"sample_type": [condition_a] * n_per_group + [condition_b] * n_per_group},
        index=all_samples,
    )
    pheno.index.name = "sample_id"

    mu_B = pd.Series(rng.lognormal(mean=3.5, sigma=0.9, size=len(geneIds)), index=geneIds)
    effects = rng.choice(
        [0, 0, 0.5, -0.5, 1.0, -1.0, 1.5, -1.5, 2.0, -2.0],
        size=len(geneIds),
        p=[0.40, 0.20, 0.12, 0.12, 0.06, 0.06, 0.02, 0.02, 0.00, 0.00],
    )
    lfc = pd.Series(effects, index=geneIds)

    dispersion = 0.08
    counts = pd.DataFrame(index=geneIds, columns=all_samples, dtype=int)

    for g in geneIds:
        mu_b = float(mu_B[g])
        mu_a = mu_b * (2.0 ** float(lfc[g]))
        b_counts = _gamma_poisson_counts(mu_b, dispersion, n_per_group, rng)
        a_counts = _gamma_poisson_counts(mu_a, dispersion, n_per_group, rng)
        counts.loc[g, samples_a] = a_counts
        counts.loc[g, samples_b] = b_counts

    counts = counts.apply(pd.to_numeric, errors="coerce").fillna(0).astype(int)
    return counts, pheno